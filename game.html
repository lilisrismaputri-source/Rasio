<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resep Ajaib Koki Cilik</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Comic Neue', cursive;
            background: linear-gradient(135deg, #f0e68c, #ffebcd);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #4a4a4a;
        }
        .game-container {
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px 40px;
            text-align: center;
            width: 90%;
            max-width: 600px;
        }
        h1, h2 {
            color: #d2691e;
        }
        #level-selection-screen h2 {
            margin-bottom: 30px;
        }
        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 20px;
        }
        .level-button {
            background-color: #ffe4b5;
            border: 2px solid #d2691e;
            border-radius: 15px;
            padding: 20px 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
            position: relative;
        }
        .level-button:hover {
            transform: translateY(-5px);
            background-color: #ffdab9;
        }
        .level-button.locked {
            background-color: #f5f5f5;
            border-color: #ccc;
            color: #aaa;
            cursor: not-allowed;
        }
        .level-button.locked .lock-icon {
            font-size: 2em;
        }
        .level-button.locked:hover {
            transform: none;
            background-color: #f5f5f5;
        }
        .level-info, .score-info {
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        .question-box {
            background-color: #ffe4b5;
            border: 2px solid #d2691e;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        /* --- KODE CSS INPUT YANG DIPERBAIKI --- */
        #student-name-input {
            border: 2px solid #d2691e;
            border-radius: 10px;
            padding: 10px;
            font-size: 1em;
            text-align: center;
            width: 80%;
            max-width: 250px;
            margin: 5px auto;
            display: block;
            font-family: 'Comic Neue', cursive;
        }
        .answer-input-group {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        .answer-input-group input {
            border: 2px solid #d2691e;
            border-radius: 10px;
            padding: 10px;
            font-size: 1em;
            text-align: center;
            width: 80px;
            font-family: 'Comic Neue', cursive;
        }
        #single-answer-input {
            border: 2px solid #d2691e;
            border-radius: 10px;
            padding: 10px;
            font-size: 1em;
            text-align: center;
            width: 150px;
            font-family: 'Comic Neue', cursive;
        }
        /* --- AKHIR DARI KODE CSS INPUT --- */

        button {
            background-color: #d2691e;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 12px 25px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 15px;
            transition: transform 0.2s;
            font-family: 'Comic Neue', cursive;
        }
        button:hover {
            transform: translateY(-3px);
            background-color: #e67e22;
        }
        .feedback { margin-top: 15px; font-weight: bold; min-height: 20px; }
        .feedback.correct { color: #28a745; }
        .feedback.incorrect { color: #dc3545; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="game-container">
        <div id="intro-screen">
            <h1>🧑‍🍳 Resep Ajaib Koki Cilik 🧑‍🍳</h1>
            <p>Halo, koki cilik! Selamat datang di dapur ajaib. Siapa nama kamu?</p>
            <input type="text" id="student-name-input" placeholder="Nama Lengkap Sesuai Absen">
            <button onclick="startGame()">Mulai Petualangan!</button>
        </div>
        
        <div id="level-selection-screen" class="hidden">
            <h2>Pilih Level Petualanganmu!</h2>
            <div class="level-grid">
                <div class="level-button" onclick="selectLevel(1)">Level 1</div>
                <div class="level-button" onclick="selectLevel(2)">Level 2</div>
                <div class="level-button" onclick="selectLevel(3)">Level 3</div>
                <div class="level-button" onclick="selectLevel(4)">Level 4</div>
                <div class="level-button" onclick="selectLevel(5)">Level 5</div>
            </div>
             <button onclick="resetProgress()">Reset Progress</button>
        </div>

        <div id="game-screen" class="hidden">
            <div class="level-info"><h2></h2><p></p></div>
            <div class="score-info">Skor: <span id="score">0</span> / 100</div>
            <div class="question-box">
                <p id="question-text"></p>
                <div id="input-area">
                    <div id="ratio-input-group" class="answer-input-group hidden">
                        <input type="text" id="answer-input-1">
                        :
                        <input type="text" id="answer-input-2">
                    </div>
                    <input type="text" id="single-answer-input" class="hidden">
                    <button id="submit-btn" onclick="checkAnswer()">Jawab!</button>
                </div>
                <div id="feedback-text" class="feedback"></div>
                <button id="next-btn" class="hidden" onclick="nextQuestion()">Soal Selanjutnya</button>
                <button id="back-to-levels-btn" class="hidden" onclick="showLevelSelection()">Kembali ke Pilihan Level</button>
            </div>
        </div>

        <div id="end-screen" class="hidden">
            <h1>🎉 Semua Level Selesai! 🎉</h1>
            <p>Selamat, <span id="student-name-final"></span>!</p>
            <p>Kamu telah menyelesaikan semua petualangan di Dapur Ajaib!</p>
            <button onclick="showLevelSelection()">Pilih Level Lain</button>
        </div>
    </div>

    <script>
        // PENTING: Ganti dengan URL Google Apps Script Anda untuk MENYIMPAN JAWABAN
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwqbrgFx04PX3qKKnKwpr5ZJsapy0GOp3y1C7zv-BaB2J_9PnR63QpyUtWUeaKh1YeV/exec';
               
        const questions = {
             level1: [
                { q: "Untuk membuat jus stroberi, Koki Cilik menggunakan 🍓 4 buah stroberi dan 🍎 8 buah apel. Berapa rasio stroberi terhadap apel?", a: "4:8" }, { q: "Koki Cilik membuat adonan pizza. Dia menggunakan 🍚 3 sendok tepung dan 💧 6 sendok air. Berapa rasio tepung terhadap air?", a: "3:6" }, { q: "Di dapur, ada 🥕 5 buah wortel dan 🍅 10 buah tomat. Berapa rasio wortel terhadap tomat?", a: "5:10" }, { q: "Koki Cilik memanggang kue. Dia menggunakan 🍫 2 batang cokelat dan 🥛 4 gelas susu. Berapa rasio cokelat terhadap susu?", a: "2:4" }, { q: "Untuk membuat puding, Koki Cilik mencampur 🍮 6 bungkus agar-agar dengan 🥛 12 gelas air. Berapa rasio agar-agar terhadap air?", a: "6:12" }
            ],
            level2: [
                { q: "Untuk membuat adonan, Koki Cilik butuh 🍚 10 sendok tepung dan 💧 5 sendok air. Dalam bentuk paling sederhana, berapa rasio tepung terhadap air?", a: "2:1" }, { q: "Koki Cilik punya 🍎 12 apel dan 🍊 6 jeruk. Berapa rasio apel terhadap jeruk dalam bentuk paling sederhana?", a: "2:1" }, { q: "Koki Cilik mencampur 🍫 8 batang cokelat dengan 🥛 16 gelas susu. Sederhanakan rasio cokelat terhadap susu!", a: "1:2" }, { q: "Ada 🥕 15 wortel dan 🍅 20 tomat. Sederhanakan rasio wortel terhadap tomat!", a: "3:4" }, { q: "Untuk membuat jus, Koki Cilik memakai 🍓 9 buah stroberi dan 🍌 6 buah pisang. Sederhanakan rasio stroberi terhadap pisang!", a: "3:2" }
            ],
            level3: [
                { q: "Resep sosis menggunakan rasio daging dan tepung 🍖:🍚 = 3:2. Jika Koki Cilik menggunakan 12 kg daging, berapa kg tepung yang dibutuhkan?", a: "8" }, { q: "Rasio stroberi dan apel di keranjang buah adalah 🍓:🍎 = 1:2. Jika ada 5 stroberi, berapa jumlah apel?", a: "10" }, { q: "Untuk membuat kue, rasio gula dan tepung adalah 🍬:🍚 = 1:3. Jika ada 6 kg gula, berapa kg tepung yang dibutuhkan?", a: "18" }, { q: "Rasio telur dan susu dalam resep puding adalah 🥚:🥛 = 2:5. Jika Koki Cilik menggunakan 10 telur, berapa gelas susu yang dibutuhkan?", a: "25" }, { q: "Rasio pisang dan kiwi di lemari es adalah 🍌:🥝 = 4:3. Jika ada 12 pisang, berapa jumlah kiwi?", a: "9" }
            ],
            level4: [
                { q: "Koki Cilik membuat 2 porsi jus dengan 10 buah stroberi. Berapa buah stroberi yang dibutuhkan untuk membuat 5 porsi jus?", a: "25" }, { q: "Dengan 3 kg tepung, Koki Cilik bisa membuat 12 roti. Berapa kg tepung yang dibutuhkan untuk membuat 20 roti?", a: "5" }, { q: "Koki Cilik membuat 5 kue dengan 15 butir telur. Berapa butir telur yang dibutuhkan untuk membuat 8 kue?", a: "24" }, { q: "Koki Cilik bisa mencampur 2 liter air dengan 3 kg gula. Berapa kg gula yang dibutuhkan untuk 10 liter air?", a: "15" }, { q: "Jika 10 gram bubuk cokelat bisa membuat 4 gelas minuman, berapa gram bubuk cokelat yang dibutuhkan untuk 6 gelas minuman?", a: "15" }
            ],
            level5: [
                { q: "Jika 3 koki bisa membuat kue dalam 4 jam, berapa jam yang dibutuhkan oleh 6 koki untuk membuat kue yang sama?", a: "2" }, { q: "Untuk memanggang kue, Koki Cilik butuh 2 oven selama 30 menit. Jika dia menggunakan 4 oven, berapa menit waktu yang dibutuhkan?", a: "15" }, { q: "Jika 5 orang bisa menghabiskan 10 liter air dalam 2 hari, berapa hari air akan habis jika ada 10 orang?", a: "1" }, { q: "Jika 6 pekerja bisa menyelesaikan proyek dalam 10 hari, berapa hari yang dibutuhkan 5 pekerja untuk menyelesaikan proyek yang sama?", a: "12" }, { q: "Koki Cilik punya 2 keran yang bisa mengisi tangki dalam 6 jam. Berapa jam waktu yang dibutuhkan jika dia menggunakan 3 keran?", a: "4" }
            ]
        };

        const levels = ["level1", "level2", "level3", "level4", "level5"];
        let currentLevel = 0;
        let currentQuestionIndex = 0;
        let currentScore = 0;
        let levelQuestions = [];
        let totalScore = 0;
        let studentName = "";
        let unlockedLevel = 1;

        const introScreen = document.getElementById('intro-screen');
        const levelSelectionScreen = document.getElementById('level-selection-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        const levelInfo = gameScreen.querySelector('.level-info h2');
        const levelDesc = gameScreen.querySelector('.level-info p');
        const scoreDisplay = document.getElementById('score');
        const questionText = document.getElementById('question-text');
        const feedbackText = document.getElementById('feedback-text');
        const submitBtn = document.getElementById('submit-btn');
        const nextBtn = document.getElementById('next-btn');
        const backToLevelsBtn = document.getElementById('back-to-levels-btn');
        const studentNameInput = document.getElementById('student-name-input');
        const studentNameFinalDisplay = document.getElementById('student-name-final');
        const ratioInputGroup = document.getElementById('ratio-input-group');
        const singleAnswerInput = document.getElementById('single-answer-input');
        const answerInput1 = document.getElementById('answer-input-1');
        const answerInput2 = document.getElementById('answer-input-2');

        const levelDescriptions = {
            level1: "Pengenalan Rasio: Tuliskan perbandingan bahan-bahan.",
            level2: "Menyederhanakan Rasio: Sederhanakan perbandingan resep ini!",
            level3: "Menghitung Jumlah: Cari tahu berapa banyak bahan yang dibutuhkan.",
            level4: "Perbandingan Senilai: Jika takaran bertambah, bahan juga bertambah.",
            level5: "Perbandingan Berbalik Nilai: Jika koki bertambah, waktu berkurang."
        };

        function startGame() {
            studentName = studentNameInput.value.trim();
            if (studentName) {
                unlockedLevel = parseInt(localStorage.getItem(studentName + '_unlockedLevel')) || 1;
                showLevelSelection();
            } else {
                alert("Masukkan nama kamu terlebih dahulu!");
            }
        }

        function showLevelSelection() {
            introScreen.classList.add('hidden');
            gameScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            levelSelectionScreen.classList.remove('hidden');
            const levelButtons = document.querySelectorAll('.level-button');
            levelButtons.forEach((button, index) => {
                const levelNum = index + 1;
                button.classList.remove('locked');
                button.innerHTML = `Level ${levelNum}`;
                if (levelNum > unlockedLevel) {
                    button.classList.add('locked');
                    button.innerHTML = `<span class="lock-icon">🔒</span>`;
                }
            });
        }

        function selectLevel(levelNum) {
            if (levelNum > unlockedLevel) {
                alert("Selesaikan level sebelumnya untuk membuka level ini!");
                return;
            }
            currentLevel = levelNum - 1;
            levelSelectionScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            loadLevel();
        }

        function loadLevel() {
            currentScore = 0;
            currentQuestionIndex = 0;
            scoreDisplay.textContent = currentScore;
            feedbackText.textContent = '';
            const levelKey = levels[currentLevel];
            levelInfo.textContent = `Level ${currentLevel + 1}`;
            levelDesc.textContent = levelDescriptions[levelKey];
            levelQuestions = shuffleArray(Object.values(questions)[currentLevel]);
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestionIndex >= levelQuestions.length) {
                endLevel();
                return;
            }
            const q = levelQuestions[currentQuestionIndex];
            questionText.textContent = q.q;
            submitBtn.style.display = 'inline-block';
            nextBtn.classList.add('hidden');
            backToLevelsBtn.classList.add('hidden');
            
            const isRatioLevel = currentLevel < 2;
            ratioInputGroup.classList.toggle('hidden', !isRatioLevel);
            singleAnswerInput.classList.toggle('hidden', isRatioLevel);

            [answerInput1, answerInput2, singleAnswerInput].forEach(input => {
                input.value = '';
                input.disabled = false;
            });
        }

        function checkAnswer() {
            let userAnswer = '';
            const correctAnswer = levelQuestions[currentQuestionIndex].a;
            if (currentLevel < 2) {
                userAnswer = `${answerInput1.value.trim()}:${answerInput2.value.trim()}`;
            } else {
                userAnswer = singleAnswerInput.value.trim();
            }
            let isCorrect = false;
            if (currentLevel === 0) {
                const userParts = userAnswer.split(':');
                const correctParts = correctAnswer.split(':');
                if (userParts.length === 2 && correctParts.length === 2 && parseFloat(userParts[1]) !== 0) {
                    isCorrect = (parseFloat(userParts[0]) / parseFloat(userParts[1])) === (parseFloat(correctParts[0]) / parseFloat(correctParts[1]));
                }
            } else {
                isCorrect = userAnswer === correctAnswer;
            }

            const questionScore = isCorrect ? 20 : 0;

            if (isCorrect) {
                currentScore += 20;
                scoreDisplay.textContent = currentScore;
                feedbackText.textContent = "Jawaban benar! 🎉";
                feedbackText.className = 'feedback correct';
            } else {
                feedbackText.textContent = "Jawaban salah.";
                feedbackText.className = 'feedback incorrect';
            }
            
            sendDataToSheet(levelQuestions[currentQuestionIndex].q, userAnswer, isCorrect ? 'Benar' : 'Salah', questionScore);
            
            submitBtn.style.display = 'none';
            nextBtn.classList.remove('hidden');
            [answerInput1, answerInput2, singleAnswerInput].forEach(input => input.disabled = true);
        }

        function nextQuestion() {
            currentQuestionIndex++;
            feedbackText.textContent = '';
            showQuestion();
        }

        function endLevel() {
            totalScore += currentScore;
            const justCompletedLevel = currentLevel + 1;
            const nextLevelToUnlock = currentLevel + 2;
            const currentUnlocked = parseInt(localStorage.getItem(studentName + '_unlockedLevel')) || 1;

            if (nextLevelToUnlock > currentUnlocked && currentScore >= 80) {
                localStorage.setItem(studentName + '_unlockedLevel', nextLevelToUnlock);
                unlockedLevel = nextLevelToUnlock;
                alert(`Level ${justCompletedLevel} Selesai! Skor: ${currentScore}. Selamat, Level ${justCompletedLevel + 1} terbuka!`);
            } else if (currentScore < 80 && nextLevelToUnlock > currentUnlocked) {
                 alert(`Level ${justCompletedLevel} Selesai! Skor: ${currentScore}. Kamu butuh skor minimal 80 untuk membuka level selanjutnya. Coba lagi ya!`);
            } else {
                alert(`Level ${justCompletedLevel} Selesai! Skor: ${currentScore}.`);
            }
            
            if (justCompletedLevel === levels.length && currentScore >= 80) {
                showEndScreen();
            } else {
                backToLevelsBtn.classList.remove('hidden');
                nextBtn.classList.add('hidden');
            }
        }

        function showEndScreen() {
            gameScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
            studentNameFinalDisplay.textContent = studentName;
        }

        function resetProgress() {
            if (studentName && confirm("Apakah kamu yakin ingin mengulang semua progress untuk nama '" + studentName + "'? Level yang terbuka akan terkunci kembali.")) {
                localStorage.removeItem(studentName + '_unlockedLevel');
                unlockedLevel = 1;
                showLevelSelection();
            } else if (!studentName) {
                alert("Silakan masukkan nama terlebih dahulu sebelum mereset progress.");
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        async function sendDataToSheet(question, answer, status, score) {
            const params = {
                nama: studentName,
                level: `Level ${currentLevel + 1}`,
                soal: question,
                jawaban: answer,
                status: status,
                skor: score
            };
            const formData = new URLSearchParams(params).toString();
            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData,
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
                });
            } catch(error) {
                console.error('Error saat mengirim data:', error);
            }
        }
    </script>
</body>
</html>

